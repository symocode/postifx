# This file was generated by Chef
# Do NOT modify this file manually

#
# SymoCode general config
#
myhostname = <%= node[:hostname] %>.symocode.com
myorigin = $myhostname
mail_owner = postfix
smtpd_banner = $myhostname Mail Server
append_dot_mydomain = no
disable_dns_lookups = no

inet_interfaces = all
inet_protocols = ipv4
mynetworks = <%= node['openvpn']['ifconfig_mx'] %>
mydomain = symocode.com
myorigin = $mydomain
#mydestination = mail.symocode.com
#authorized_submit_users =

#
# Relay internal mail forwarding to $mailhost from Zimbra
#
relay_domains = <%= node['postfix']['relay_domains'] %>
transport_maps = hash:/etc/postfix/transport

#
# Default settings
#
queue_directory = /var/spool/postfix
command_directory = /usr/sbin
daemon_directory = /usr/libexec/postfix
data_directory = /var/lib/postfix

#
# SMTPD/SASL configuration
#
smtpd_sasl_auth_enable = yes
smtpd_helo_required = yes
#Restrictions based in the context of the MAIL FROM command. I.e. restrictions based on who emails are from.
smtpd_sender_restrictions =
                reject_unknown_address

#
# Restrictions based on the RCPT TO command. I.e. restrictions based on who emails are been delivered to.
#
smtpd_recipient_restrictions =
                permit_mynetworks,
                permit_sasl_authenticated,
                reject_unauth_destination,
                reject_invalid_hostname,
                reject_unauth_pipelining,
                reject_non_fqdn_sender,
                reject_non_fqdn_recipient,
                reject_unknown_sender_domain,
                reject_unknown_recipient_domain,
                reject_rbl_client zen.spamhaus.org,
                reject_rbl_client bl.spamcop.net

#
# SMTP server access restrictions in the context of a SMTP connection request.
#
smtpd_client_restrictions =
                permit_mynetworks,
                permit_sasl_authenticated,
                reject_unauth_destination

smtpd_sasl_security_options = noanonymous

#
# TLS
#
smtpd_tls_cert_file = /etc/postfix/certs/postfix.pem
smtpd_tls_key_file = /etc/postfix/certs/postfix.key
smtpd_tls_loglevel = 1
smtpd_use_tls = yes
# Disabling SSLv3
smtpd_tls_mandatory_protocols=!SSLv2,!SSLv3
smtp_tls_mandatory_protocols=!SSLv2,!SSLv3
smtpd_tls_protocols=!SSLv2,!SSLv3
smtp_tls_protocols=!SSLv2,!SSLv3

#
# DDOS configuration
#
default_process_limit = 100
smtpd_client_connection_count_limit = 10
smtpd_client_connection_rate_limit = 30
queue_minfree = 20971520
header_size_limit = 51200
message_size_limit = 10485760
smtpd_recipient_limit = 100
maximal_queue_lifetime = 2d
bounce_queue_lifetime = 1d
